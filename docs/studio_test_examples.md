# LangGraph Studio æµ‹è¯•ç¤ºä¾‹

## ğŸš€ åœ¨ LangGraph Studio ä¸­æµ‹è¯•æ™ºèƒ½è¿ç»´æ™ºèƒ½ä½“

### å¯åŠ¨æœåŠ¡å™¨
ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼š
```bash
./scripts/start_server.sh
```

æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼š
```bash
source .venv/bin/activate
langgraph dev --port 2024 --host 127.0.0.1 --no-browser
```

### è®¿é—® Studio UI
Studio URL: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024

### å¯ç”¨çš„å›¾
- **`ops-agent`** - ç»Ÿä¸€çš„æ™ºèƒ½è¿ç»´æ™ºèƒ½ä½“ï¼ˆæ¨èä½¿ç”¨ï¼‰

## ğŸ—ï¸ ç»Ÿä¸€æ¶æ„è¯´æ˜

### æ ¸å¿ƒç‰¹æ€§
- **ğŸ”„ çŠ¶æ€é©±åŠ¨**: åŸºäº `ChatState` çš„ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- **ğŸ§  æ™ºèƒ½è·¯ç”±**: `IntelligentRouter` æ¨¡å—åˆ†æå®Œæ•´çŠ¶æ€å¹¶å†³å®šä¸‹ä¸€æ­¥
- **ğŸ¯ ç»Ÿä¸€å®ç°**: æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ `IntelligentOpsAgent` ç±»ä¸­
- **ğŸ“ˆ ä¸­æ–­æ¢å¤**: æ”¯æŒ `collect_info` èŠ‚ç‚¹çš„äººå·¥å¹²é¢„

### å·¥ä½œæµç¨‹
```
initialize â†’ router â†’ [business_nodes | collect_info] â†’ router â†’ finalize
```

**ä¸šåŠ¡èŠ‚ç‚¹æ‰§è¡Œé¡ºåº**: 
`process_alert` â†’ `diagnose_issue` â†’ `plan_actions` â†’ `execute_actions` â†’ `generate_report`

**ä¿¡æ¯æ”¶é›†æ¨¡å¼**: 
ç¼ºå°‘å‰ç½®æ¡ä»¶ â†’ `collect_info` â†’ æ›´æ–°çŠ¶æ€ â†’ `router` â†’ é‡æ–°è·¯ç”±

## ğŸ“‹ æµ‹è¯•ç¤ºä¾‹

### ğŸ¯ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èï¼‰

#### èŠå¤©æ¨¡å¼
1. å¯åŠ¨æœåŠ¡å™¨ï¼š`./scripts/start_server.sh`
2. è®¿é—® Studio å¹¶é€‰æ‹© `ops-agent` å›¾
3. åˆ‡æ¢åˆ° **Chat** æ¨¡å¼
4. ç›´æ¥è¾“å…¥è‡ªç„¶è¯­è¨€æè¿°

**ç¤ºä¾‹è¾“å…¥**:
```
æˆ‘ä»¬çš„webæœåŠ¡å™¨CPUä½¿ç”¨ç‡è¾¾åˆ°95%ï¼Œå·²ç»æŒç»­äº†10åˆ†é’Ÿï¼Œç”¨æˆ·å¼€å§‹æŠ¥å‘Šç½‘ç«™è®¿é—®ç¼“æ…¢
```

### 1. å®Œæ•´å‘Šè­¦å¤„ç†æµ‹è¯•

**è¾“å…¥ (ChatState æ ¼å¼)**:
```json
{
  "alert_info": {
    "alert_id": "cpu_high_001",
    "timestamp": "2025-01-09T10:30:00Z",
    "severity": "high",
    "source": "prometheus",
    "message": "CPU usage exceeds 90% for 5 minutes",
    "metrics": {
      "cpu_usage": 0.95,
      "memory_usage": 0.65,
      "load_average": 3.2
    },
    "tags": ["cpu", "performance", "critical"]
  }
}
```

**é¢„æœŸæµç¨‹**: `initialize` â†’ `router` â†’ `process_alert` â†’ `router` â†’ `diagnose_issue` â†’ `router` â†’ `plan_actions` â†’ `router` â†’ `finalize`

**é¢„æœŸè¾“å‡º**: å®Œæ•´çš„è¿ç»´å¤„ç†æŠ¥å‘Šï¼ŒåŒ…æ‹¬å‘Šè­¦åˆ†æã€è¯Šæ–­ç»“æœã€è¡ŒåŠ¨è®¡åˆ’

---

### 2. ç—‡çŠ¶è¯Šæ–­æµ‹è¯•

**è¾“å…¥**:
```json
{
  "symptoms": [
    "APIå“åº”æ—¶é—´å¢åŠ åˆ°5ç§’",
    "æ•°æ®åº“è¿æ¥æ± è€—å°½", 
    "å†…å­˜ä½¿ç”¨ç‡æŒç»­ä¸Šå‡",
    "é”™è¯¯æ—¥å¿—æ˜¾ç¤ºOutOfMemoryError"
  ],
  "context": {
    "system_type": "å¾®æœåŠ¡æ¶æ„",
    "peak_traffic": true,
    "recent_deployments": ["user-service-v2.1", "payment-service-v1.3"]
  }
}
```

**é¢„æœŸæµç¨‹**: `initialize` â†’ `router` â†’ `diagnose_issue` â†’ `router` â†’ `plan_actions` â†’ `router` â†’ `finalize`

---

### 3. ä»…æ¶ˆæ¯è¾“å…¥æµ‹è¯• (Graph æ¨¡å¼)

**è¾“å…¥**:
```json
{
  "messages": [
    {
      "role": "user",
      "content": "ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“CPUä½¿ç”¨ç‡90%ï¼ŒwebæœåŠ¡å¼€å§‹æŠ¥500é”™è¯¯"
    }
  ]
}
```

**é¢„æœŸæµç¨‹**: `initialize` â†’ `router` â†’ `collect_info` (ä»æ¶ˆæ¯æå–ä¿¡æ¯) â†’ `router` â†’ ä¸šåŠ¡æµç¨‹

---

## âš¡ ä¸­æ–­æ¢å¤æµ‹è¯•

### ğŸ”§ ä¸­æ–­æœºåˆ¶è¯´æ˜

å½“è·¯ç”±å™¨å†³å®šéœ€è¦æ”¶é›†æ›´å¤šä¿¡æ¯æ—¶ï¼Œä¼šè‡ªåŠ¨è·¯ç”±åˆ° `collect_info` èŠ‚ç‚¹ï¼š
- **è§¦å‘æ¡ä»¶**: ä¸šåŠ¡èŠ‚ç‚¹ç¼ºå°‘å¿…è¦çš„å‰ç½®æ•°æ®
- **ä¸­æ–­æ–¹å¼**: `collect_info` èŠ‚ç‚¹è°ƒç”¨ `request_operator_input()` å‡½æ•°
- **æ¢å¤æ–¹å¼**: ç”¨æˆ·æä¾›ä¿¡æ¯åï¼Œè‡ªåŠ¨è¿”å› `router` é‡æ–°åˆ†æ

### åœºæ™¯ 1: ä¿¡æ¯ä¸å®Œæ•´è§¦å‘ä¸­æ–­

**è¾“å…¥ (ä¸å®Œæ•´ä¿¡æ¯)**:
```json
{
  "messages": [
    {
      "role": "user",
      "content": "ç³»ç»Ÿæœ‰äº›é—®é¢˜ï¼Œä¸å¤ªç¡®å®šå…·ä½“æƒ…å†µ"
    }
  ]
}
```

**é¢„æœŸè¡Œä¸º**:
1. `router` åˆ†æå‘ç°ä¿¡æ¯ä¸è¶³
2. è·¯ç”±åˆ° `collect_info` èŠ‚ç‚¹
3. **ä¸­æ–­**: æ˜¾ç¤º"ğŸ“ éœ€è¦è¡¥å……ä¿¡æ¯"æç¤º
4. **ç­‰å¾…ç”¨æˆ·è¾“å…¥**: åœ¨ Studio ä¸­æš‚åœ

**Resume è¾“å…¥ç¤ºä¾‹** (ç›´æ¥æ–‡æœ¬):
```
å‘ç°æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œè€Œä¸”æœ‰å¾ˆå¤šæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒAPIå“åº”æ—¶é—´å˜æ…¢
```

**é¢„æœŸæ¢å¤**: 
- å°†ç”¨æˆ·è¾“å…¥æ·»åŠ åˆ°æ¶ˆæ¯å†å²
- è¿”å› `router` é‡æ–°åˆ†æ
- åŸºäºè¡¥å……ä¿¡æ¯è·¯ç”±åˆ°åˆé€‚çš„ä¸šåŠ¡èŠ‚ç‚¹

### åœºæ™¯ 2: ç¼ºå°‘å‘Šè­¦è¯¦æƒ…è§¦å‘ä¸­æ–­

**è¾“å…¥**:
```json
{
  "messages": [
    {
      "role": "user", 
      "content": "CPUå‘Šè­¦"
    }
  ]
}
```

**é¢„æœŸè¡Œä¸º**:
1. `router` å°è¯•è·¯ç”±åˆ° `process_alert`
2. å‘ç° `alert_info` ä¸ºç©º
3. è·¯ç”±åˆ° `collect_info` æ”¶é›†å‘Šè­¦è¯¦æƒ…
4. **ä¸­æ–­**: è¯·æ±‚æä¾›è¯¦ç»†çš„å‘Šè­¦ä¿¡æ¯

**Resume è¾“å…¥ç¤ºä¾‹**:
```
æœåŠ¡å™¨CPUä½¿ç”¨ç‡95%ï¼ŒæŒç»­10åˆ†é’Ÿï¼Œå‘Šè­¦IDæ˜¯cpu_spike_001ï¼Œæ¥æºæ˜¯prometheusç›‘æ§
```

---

## ğŸ§  æ™ºèƒ½è·¯ç”±æµ‹è¯•

### Router å†³ç­–é€»è¾‘

`IntelligentRouter` åŸºäºå®Œæ•´çš„ `ChatState` åˆ†æå¹¶å†³å®šä¸‹ä¸€æ­¥ï¼š

1. **æœ‰ alert_info** â†’ `process_alert`
2. **æœ‰ symptoms** â†’ `diagnose_issue`  
3. **æœ‰ diagnostic_result** â†’ `plan_actions`
4. **æœ‰ action_plan** â†’ `execute_actions`
5. **ç¼ºå°‘å‰ç½®æ¡ä»¶** â†’ `collect_info`
6. **æ‰€æœ‰å¤„ç†å®Œæˆ** â†’ `generate_report` â†’ `finalize`

### æµ‹è¯•è·¯ç”±å†³ç­–

**æµ‹è¯• 1: ç›´æ¥å‘Šè­¦è·¯ç”±**
```json
{
  "alert_info": {
    "alert_id": "test_001",
    "severity": "high", 
    "message": "Database connection timeout"
  }
}
```
**é¢„æœŸ**: ç›´æ¥è·¯ç”±åˆ° `process_alert`

**æµ‹è¯• 2: è¯Šæ–­è·¯ç”±**
```json
{
  "symptoms": ["slow response", "high CPU"],
  "alert_info": {
    "alert_id": "processed_001"
  }
}
```
**é¢„æœŸ**: è·³è¿‡ `process_alert`ï¼Œç›´æ¥è·¯ç”±åˆ° `diagnose_issue`

---

## ğŸ›ï¸ é«˜çº§æµ‹è¯•åœºæ™¯

### 1. å®Œæ•´å·¥ä½œæµæµ‹è¯•

**ç›®æ ‡**: æµ‹è¯•ä»å‘Šè­¦åˆ°æŠ¥å‘Šçš„å®Œæ•´æµç¨‹

**è¾“å…¥**:
```json
{
  "alert_info": {
    "alert_id": "full_test_001",
    "timestamp": "2025-01-09T15:00:00Z",
    "severity": "critical",
    "source": "monitoring",
    "message": "Web service completely down",
    "metrics": {"availability": 0.0},
    "tags": ["web", "outage", "critical"]
  }
}
```

**è§‚å¯Ÿç‚¹**:
- âœ… Router çš„è·¯ç”±å†³ç­–æ—¥å¿—
- âœ… æ¯ä¸ªä¸šåŠ¡èŠ‚ç‚¹çš„å¤„ç†ç»“æœ
- âœ… çŠ¶æ€åœ¨èŠ‚ç‚¹é—´çš„ä¼ é€’
- âœ… æœ€ç»ˆæŠ¥å‘Šçš„ç”Ÿæˆ

### 2. é”™è¯¯å¤„ç†æµ‹è¯•

**è¾“å…¥ (æ— æ•ˆæ•°æ®)**:
```json
{
  "invalid_field": "test",
  "messages": [
    {
      "role": "user",
      "content": "invalid input test"
    }
  ]
}
```

**é¢„æœŸ**: 
- Router å¤„ç†æ— æ•ˆè¾“å…¥
- è·¯ç”±åˆ° `collect_info` è¯·æ±‚æ¾„æ¸…
- é”™è¯¯å¤„ç†ä¸ä¼šå¯¼è‡´å·¥ä½œæµå´©æºƒ

---

## ğŸ› ï¸ å®é™…æµ‹è¯•æ­¥éª¤

### åœ¨ LangGraph Studio ä¸­æµ‹è¯•

1. **å¯åŠ¨æœåŠ¡**:
   ```bash
   ./scripts/start_server.sh
   ```

2. **è®¿é—® Studio**: 
   https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024

3. **é€‰æ‹©å›¾**: `ops-agent`

4. **æµ‹è¯•å®Œæ•´æµç¨‹**:
   - **Graph æ¨¡å¼**: ä½¿ç”¨ä¸Šè¿° JSON è¾“å…¥
   - **Chat æ¨¡å¼**: ç›´æ¥æ–‡æœ¬å¯¹è¯

5. **æµ‹è¯•ä¸­æ–­æ¢å¤**:
   - è¾“å…¥ä¸å®Œæ•´ä¿¡æ¯
   - è§‚å¯Ÿä¸­æ–­è§¦å‘
   - ä½¿ç”¨ Resume åŠŸèƒ½æä¾›è¡¥å……ä¿¡æ¯
   - éªŒè¯å·¥ä½œæµæ­£ç¡®æ¢å¤

---

## ğŸ” è§‚å¯Ÿè¦ç‚¹

### çŠ¶æ€ç®¡ç†
- âœ… `ChatState` å­—æ®µçš„æ­£ç¡®æ›´æ–°
- âœ… æ¶ˆæ¯å†å²çš„å®Œæ•´ä¿å­˜
- âœ… ä¸šåŠ¡æ•°æ®çš„æ­£ç¡®ä¼ é€’

### è·¯ç”±é€»è¾‘
- âœ… Router çš„å†³ç­–å‡†ç¡®æ€§
- âœ… æ¡ä»¶æ£€æŸ¥çš„æ­£ç¡®æ€§
- âœ… ç›®æ ‡èŠ‚ç‚¹çš„è®¾ç½®

### ä¸­æ–­å¤„ç†
- âœ… ä¸­æ–­è§¦å‘çš„åŠæ—¶æ€§
- âœ… ä¸­æ–­ä¿¡æ¯çš„æ¸…æ™°åº¦
- âœ… æ¢å¤åçš„æ­£ç¡®æ‰§è¡Œ

### ä¸šåŠ¡é€»è¾‘
- âœ… DSPy æ¨¡å—çš„æ¨ç†è´¨é‡
- âœ… å‘Šè­¦åˆ†æçš„å‡†ç¡®æ€§
- âœ… è¯Šæ–­ç»“æœçš„å¯ä¿¡åº¦
- âœ… è¡ŒåŠ¨è®¡åˆ’çš„åˆç†æ€§

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä¸­æ–­ä¸è§¦å‘**
   - æ£€æŸ¥è¾“å…¥æ˜¯å¦çœŸçš„ç¼ºå°‘å¿…è¦ä¿¡æ¯
   - ç¡®è®¤ `collect_info` èŠ‚ç‚¹çš„è·¯ç”±æ¡ä»¶
   - æ£€æŸ¥ `request_operator_input` å‡½æ•°

2. **è·¯ç”±å†³ç­–é”™è¯¯**
   - æ£€æŸ¥ `IntelligentRouter` çš„åˆ†æé€»è¾‘
   - ç¡®è®¤ `ChatState` å­—æ®µçš„æ­£ç¡®è®¾ç½®
   - æŸ¥çœ‹ Router çš„è°ƒè¯•æ—¥å¿—

3. **çŠ¶æ€ä¸ä¸€è‡´**
   - æ£€æŸ¥èŠ‚ç‚¹é—´çš„çŠ¶æ€ä¼ é€’
   - ç¡®è®¤çŠ¶æ€æ›´æ–°çš„åŸå­æ€§
   - éªŒè¯çŠ¶æ€éªŒè¯é€»è¾‘

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨è¯¦ç»†æ—¥å¿—**: è§‚å¯Ÿæ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥è¾“å‡º
2. **åˆ†æ­¥æµ‹è¯•**: é€ä¸ªæµ‹è¯•å„ä¸ªåŠŸèƒ½æ¨¡å—
3. **çŠ¶æ€æ£€æŸ¥**: åœ¨ Studio ä¸­æŸ¥çœ‹ `ChatState` å˜åŒ–
4. **é”™è¯¯æ•è·**: æ³¨æ„ `errors` å­—æ®µçš„å†…å®¹

---

## ğŸ¯ éªŒè¯ç›®æ ‡

é€šè¿‡è¿™äº›æµ‹è¯•ï¼ŒéªŒè¯ï¼š

### æ ¸å¿ƒåŠŸèƒ½
- âœ… çŠ¶æ€é©±åŠ¨çš„å·¥ä½œæµæ‰§è¡Œ
- âœ… æ™ºèƒ½è·¯ç”±çš„å‡†ç¡®æ€§
- âœ… ä¸­æ–­æ¢å¤çš„å¯é æ€§
- âœ… ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§

### ç”¨æˆ·ä½“éªŒ
- âœ… è‡ªç„¶è¯­è¨€äº¤äº’çš„æµç•…æ€§
- âœ… ä¸­æ–­æç¤ºçš„æ¸…æ™°åº¦
- âœ… é”™è¯¯å¤„ç†çš„å‹å¥½æ€§
- âœ… æ•´ä½“æµç¨‹çš„ç›´è§‚æ€§

### æŠ€æœ¯é›†æˆ
- âœ… DeepSeek LLM çš„ç¨³å®šæ€§
- âœ… DSPy æ¨¡å—çš„å¯é æ€§
- âœ… LangGraph å·¥ä½œæµçš„æ­£ç¡®æ€§
- âœ… Studio ç•Œé¢çš„å“åº”æ€§

---

## ğŸš€ æ¨èæµ‹è¯•æµç¨‹

### 1. å¿«é€ŸéªŒè¯
```bash
# èŠå¤©æ¨¡å¼æµ‹è¯•
è¾“å…¥: "CPUä½¿ç”¨ç‡è¿‡é«˜ï¼Œéœ€è¦åˆ†æ"
é¢„æœŸ: å®Œæ•´çš„è¿ç»´å¤„ç†æµç¨‹
```

### 2. ä¸­æ–­æµ‹è¯•
```bash
# ä¸å®Œæ•´ä¿¡æ¯æµ‹è¯•
è¾“å…¥: "ç³»ç»Ÿæœ‰é—®é¢˜"
é¢„æœŸ: ä¸­æ–­å¹¶è¯·æ±‚æ›´å¤šä¿¡æ¯
```

### 3. å®Œæ•´æµç¨‹æµ‹è¯•
```bash
# å¤æ‚åœºæ™¯æµ‹è¯•
è¾“å…¥: ç»“æ„åŒ–çš„å‘Šè­¦ä¿¡æ¯
é¢„æœŸ: å®Œæ•´çš„å‘Šè­¦â†’è¯Šæ–­â†’è§„åˆ’â†’æŠ¥å‘Šæµç¨‹
```

æˆåŠŸé€šè¿‡è¿™äº›æµ‹è¯•åï¼Œæ‚¨çš„æ™ºèƒ½è¿ç»´ç³»ç»Ÿå°±å·²ç»å‡†å¤‡å¥½å¤„ç†çœŸå®çš„è¿ç»´åœºæ™¯äº†ï¼ ğŸ‰